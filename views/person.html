{% extends 'base.html' %} {% set title = "Grizzly: Persons" %}
{% block content
    %}
    <div class="px-1 text-3xl font-semibold mtb-5">Persons</div>
    <div x-data="pageUtils" class="container mx-auto">
        <div class="overflow-x-auto p-3 mx-auto max-w-xl bg-white rounded-md border border-gray-300">
            <div x-cloak
                 x-show="showToast"
                 class="fixed right-4 bottom-4 p-4 w-72 h-32 rounded transition-transform transform-gpu duration-400 ease bg-slate-700"
                 :class="toastType === 'success' ? 'border-l border-4 border-green-500' : 'bg-red-400'"
                 x-transition:enter-start="translate-y-full"
                 x-transition:enter-end="translate-y-0"
                 x-transition:leave-start="translate-y-0"
                 x-transition:leave-end="translate-y-full">
                <p class="text-white">
                    <strong x-text="toastTitle"></strong>
                </p>
                <p class="mt-2 text-sm text-white" x-text="toastMessage"></p>
            </div>
            <h3 class="text-2xl">Search</h3>
            <p x-show="showToast" x-text="toastMessage"></p>
            <table class="table-auto">
                <tbody id="person-table" class="divide-y">
                    {% for person in data %}
                        <tr x-data="clipboardHelper">
                            <td class="flex py-2 space-x-1">
                                <img src="{{ person.profile_image_url }}"
                                     alt="{{ person.first_name }} {{ person.last_name }}'s avatar"
                                     class="w-10 h-10 rounded-full">
                                <div>
                                    {{ person.first_name }} {{ person.last_name }}
                                    <div class="text-sm text-gray-500">
                                        {{ person.email }}<span class="ml-1 text-blue-500"><i @click="copyToClipboard('{{ person.email }}')"
   class="p-1 rounded transition ease-in-out hover:bg-gray-100 bi bi-clipboard"></i></span>
                                    </div>
                                </div>
                            </td>
                            <td class="py-2 text-sm text-right">
                                {{ person.emplid }}<i @click="copyToClipboard('{{ person.emplid }}')"
   class="p-1 ml-1 text-blue-500 rounded transition ease-in-out hover:bg-gray-100 bi bi-clipboard"></i>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <script>
            document.addEventListener('alpine:init', () => {
                Alpine.data('clipboardHelper', () => ({
                    async copyToClipboard(value) {
                        await navigator.clipboard.writeText(value)
                        this.sendNotification(`Wrote ${value} to clipboard.`)
                    }
                }))
                Alpine.data('pageUtils', () => ({
                    showToast: false,
                    toastMessage: '',
                    toastTitle: 'Success',
                    toastType: 'success',
                    async sendNotification(message, opts) {
                        this.toastMessage = message
                        this.showToast = true
                        await new Promise(res => setTimeout(res, 3000))
                        this.showToast = false
                    }
                }))
            })
        </script>
    </div>
{% endblock %}
